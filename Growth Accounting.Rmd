```{r}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, magrittr)
```

# Fuentes del crecimiento económico: La productividad de los factores en el mundo

```{r}
data <- read_csv("data.csv")
```

## (a) Per capita GDP growth rates by region

```{r}
library(scales)

data %>%
  mutate(pcap = y/pop,
         pcap_growth = ((pcap - lag(pcap) ) / pcap) * 100) %>% 
  filter(year != 1979) %>%
  ggplot(aes(year, pcap_growth, color = region)) +
  geom_line() +
  labs(title = "Crecimiento del ingreso per cápita",
       subtitle = "Precios constantes del 2017",
       color = "Región:",
       caption = "Penn World Table (v 10.0)") +
  scale_y_continuous(labels = comma) +
  guides(color = guide_legend(nrow = 1)) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.title = element_text(
      face = "bold",
      hjust = .5,
      margin = margin(10, 0, 5, 0)
    ),
    plot.subtitle = element_text(hjust = .5, margin = margin(0, 0, 15, 0)),
    plot.caption = element_text(color = "gray50", size = 8, margin = margin(15, 0, 0, 0)),
    legend.position = "bottom",
    legend.title = element_text(size = 9),
    panel.background = element_rect(fill = "gray95")
  )
```

## (c) Solow growth accounting by sub region

```{r}
# Solow decomposition
solow <-
  data %>%
  mutate(
    # Logs of output, capital and labor
    y = log(y),
    k = log(k),
    l = log(l),
    # First differences (growth rates)
    dy = (y - lag(y)) * 100,
    dk = (k - lag(k)) * 100,
    dl = (l - lag(l)) * 100,
    # Share of capital in the economy
    capsh = 1 - labsh,
    # Contributions of factors in the output growth
    k_cont = dk * capsh,
    l_cont = dl * labsh,
    tfp_cont = dy - k_cont - l_cont
  ) %>%
  na.omit()
```

```{r}
solow_sub %>%
  select(sub_region, year, k_cont, l_cont, tfp_cont) %>%
  pivot_longer(-c(sub_region, year)) %>%
  ggplot(aes(year, value, fill = name)) +
  geom_col() +
  # geom_line(aes(y = dy), color = "gray35", size = .8) +
  labs(title = "Contabilidad del crecimiento",
       subtitle = "Contribución de los factores productivos al crecimiento económico",
       caption = "Datos: Penn World Table (v 10.0)") +
  guides(color = guide_legend(nrow = 1)) +
  scale_fill_discrete(name = "Contribución:",
                      labels = c("Capital", "Trabajo", "PTF")) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.title = element_text(
      face = "bold",
      hjust = .5,
      margin = margin(10, 0, 5, 0)
    ),
    plot.subtitle = element_text(hjust = .5, margin = margin(0, 0, 15, 0)),
    plot.caption = element_text(color = "gray50", size = 8),
    legend.position = "bottom",
    legend.title = element_text(size = 9),
    panel.background = element_rect(fill = "gray95")
  )
```

## (d) Solow growth accounting for Guatemala

```{r}
{r}
# Solow decomposition
solow <- 
  data %>% 
  filter(year >= 1950 & countrycode == "GTM") %>% 
  mutate(
    # Logs of output, capital and labor
    y = log(y),
    k = log(k),
    l = log(l),
    # First differences (growth rates)
    dy = (y - lag(y)) * 100,
    dk = (k - lag(k)) * 100,
    dl = (l - lag(l)) * 100,
    # Share of capital in the economy
    capsh = 1 - labsh,
    # Contributions of factors in the output growth
    k_cont = dk * capsh,
    l_cont = dl * labsh,
    tfp_cont = dy - k_cont - l_cont
    ) %>% 
  na.omit()
```
